<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{LABEL_PAGE_TITLE}}</title>
    <style>
      :root {
        --ofx-income-color: #4ade80;
        --ofx-income-bg: rgba(74, 222, 128, 0.1);
        --ofx-income-light-color: #86efac;
        --ofx-expense-color: #f87171;
        --ofx-expense-bg: rgba(248, 113, 113, 0.1);
        --ofx-expense-light-color: #fca5a5;
        --ofx-neutral-color: #60a5fa;
        --ofx-border-radius: 8px;
        --ofx-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        --ofx-shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.15);
        --ofx-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        padding: 20px;
        margin: 0;
        color: var(--vscode-foreground);
        background-color: var(--vscode-editor-background);
        line-height: 1.6;
      }
      .header {
        margin-bottom: 30px;
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        margin: 0 0 10px 0;
        color: var(--vscode-foreground);
        font-size: 28px;
        font-weight: 600;
      }

      h2 {
        color: var(--vscode-foreground);
        font-size: 20px;
        font-weight: 600;
        margin: 0 0 16px 0;
      }

      .account-info {
        color: var(--vscode-descriptionForeground);
        font-size: 14px;
        margin-bottom: 20px;
        padding: 12px;
        background: var(--vscode-editor-inactiveSelectionBackground);
        border-radius: var(--ofx-border-radius);
        border-left: 3px solid var(--vscode-focusBorder);
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        padding: 20px;
        background: var(--vscode-editor-inactiveSelectionBackground);
        border-radius: var(--ofx-border-radius);
        border: 1px solid var(--vscode-panel-border);
        box-shadow: var(--ofx-shadow);
        transition: var(--ofx-transition);
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--vscode-focusBorder);
        transform: scaleX(0);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--ofx-shadow-hover);
      }

      .stat-card:hover::before {
        transform: scaleX(1);
      }

      .stat-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--vscode-descriptionForeground);
        margin-bottom: 8px;
        font-weight: 500;
      }

      .stat-value {
        font-size: 28px;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      .stat-value.income {
        color: var(--ofx-income-color);
      }

      .stat-value.expense {
        color: var(--ofx-expense-color);
      }

      .stat-value.total {
        color: var(--vscode-foreground);
      }
      .chart-container {
        margin-bottom: 30px;
        padding: 24px;
        background: var(--vscode-editor-inactiveSelectionBackground);
        border-radius: var(--ofx-border-radius);
        border: 1px solid var(--vscode-panel-border);
        box-shadow: var(--ofx-shadow);
      }

      .chart {
        display: flex;
        height: 200px;
        align-items: flex-end;
        gap: 40px;
        margin-top: 20px;
        padding: 0 20px;
      }

      .bar-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        height: 100%;
      }

      .bar {
        width: 100%;
        max-width: 120px;
        border-radius: 6px 6px 0 0;
        transition: var(--ofx-transition);
        position: relative;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
      }

      .bar::after {
        content: attr(data-chart-parcent) "%";
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 14px;
        font-weight: 600;
        color: var(--vscode-foreground);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .bar:hover {
        opacity: 0.85;
        transform: scaleY(1.02);
      }

      .bar:hover::after {
        opacity: 1;
      }

      .bar.income {
        background: linear-gradient(to top, var(--ofx-income-color), var(--ofx-income-light-color));
      }

      .bar.expense {
        background: linear-gradient(
          to top,
          var(--ofx-expense-color),
          var(--ofx-expense-light-color)
        );
      }

      .bar-label {
        font-size: 13px;
        margin-top: 12px;
        color: var(--vscode-descriptionForeground);
        font-weight: 500;
        text-align: center;
      }
      .filters {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .search-container {
        flex: 1;
        min-width: 250px;
        max-width: 400px;
        position: relative;
      }

      .search-input {
        width: 100%;
        padding: 10px 16px;
        padding-left: 36px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        border: 1px solid var(--vscode-input-border);
        border-radius: var(--ofx-border-radius);
        font-size: 14px;
        outline: none;
        transition: var(--ofx-transition);
      }

      .search-input:focus {
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 0 0 1px var(--vscode-focusBorder);
      }

      .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--vscode-descriptionForeground);
        pointer-events: none;
      }

      .filter-btn {
        padding: 10px 16px;
        background: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
        border: 1px solid var(--vscode-panel-border);
        border-radius: var(--ofx-border-radius);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--ofx-transition);
        white-space: nowrap;
      }

      .filter-btn:hover {
        background: var(--vscode-button-secondaryHoverBackground);
        transform: translateY(-1px);
        box-shadow: var(--ofx-shadow);
      }

      .filter-btn.active {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border-color: var(--vscode-button-background);
        box-shadow: var(--ofx-shadow);
      }

      .filter-btn:active {
        transform: translateY(0);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: var(--vscode-editor-inactiveSelectionBackground);
        border-radius: var(--ofx-border-radius);
        overflow: hidden;
        box-shadow: var(--ofx-shadow);
      }

      th {
        background: var(--vscode-editorGroupHeader-tabsBackground);
        padding: 14px 12px;
        text-align: left;
        font-weight: 600;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--vscode-panel-border);
        color: var(--vscode-descriptionForeground);
        cursor: pointer;
        user-select: none;
        position: relative;
        transition: background 0.2s ease;
      }

      th:hover {
        background: var(--vscode-list-hoverBackground);
      }

      th.sortable::after {
        content: "‚áÖ";
        position: absolute;
        right: 8px;
        opacity: 0.3;
        font-size: 12px;
      }

      th.sorted-asc::after {
        content: "‚Üë";
        opacity: 1;
        color: var(--vscode-focusBorder);
      }

      th.sorted-desc::after {
        content: "‚Üì";
        opacity: 1;
        color: var(--vscode-focusBorder);
      }

      td {
        padding: 14px 12px;
        border-bottom: 1px solid var(--vscode-panel-border);
        font-size: 14px;
      }

      tr:last-child td {
        border-bottom: none;
      }

      tbody tr {
        transition: background 0.2s ease;
      }

      tbody tr:hover {
        background: var(--vscode-list-hoverBackground);
      }

      .amount {
        font-weight: 600;
        font-family: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, monospace;
        text-align: right;
        font-size: 14px;
      }

      .amount.positive {
        color: var(--ofx-income-color);
      }

      .amount.negative {
        color: var(--ofx-expense-color);
      }

      .transaction-type {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .transaction-type.positive {
        background: var(--ofx-income-bg);
        color: var(--ofx-income-color);
      }

      .transaction-type.negative {
        background: var(--ofx-expense-bg);
        color: var(--ofx-expense-color);
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--vscode-descriptionForeground);
      }

      .empty-state p {
        margin: 0;
        font-size: 16px;
      }

      .export-btn {
        padding: 10px 20px;
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        border-radius: var(--ofx-border-radius);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--ofx-transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .export-btn:hover {
        background: var(--vscode-button-hoverBackground);
        transform: translateY(-1px);
        box-shadow: var(--ofx-shadow);
      }

      .export-btn:active {
        transform: translateY(0);
      }

      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 16px;
        flex-wrap: wrap;
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }

        .stats {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stat-card {
          padding: 16px;
        }

        .stat-value {
          font-size: 24px;
        }

        .chart-container {
          padding: 16px;
        }

        .chart {
          gap: 20px;
          padding: 0;
        }

        .toolbar {
          flex-direction: column;
          align-items: stretch;
        }

        .search-container {
          max-width: 100%;
        }

        .filters {
          justify-content: center;
        }

        table {
          font-size: 13px;
        }

        th,
        td {
          padding: 10px 8px;
        }

        h1 {
          font-size: 24px;
        }

        h2 {
          font-size: 18px;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Tooltips */
      [title] {
        position: relative;
      }

      .stat-card[title]:hover::after,
      .filter-btn[title]:hover::after,
      th[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 6px 12px;
        background: var(--vscode-editorHoverWidget-background);
        border: 1px solid var(--vscode-editorHoverWidget-border);
        color: var(--vscode-editorHoverWidget-foreground);
        font-size: 12px;
        white-space: nowrap;
        border-radius: 4px;
        margin-bottom: 8px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        pointer-events: none;
      }

      .stat-card[title]:hover::before,
      .filter-btn[title]:hover::before,
      th[title]:hover::before {
        content: "";
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: var(--vscode-editorHoverWidget-border);
        margin-bottom: 2px;
        z-index: 1000;
        pointer-events: none;
      }

      /* Loading animation */
      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      .loading {
        animation: shimmer 2s infinite linear;
        background: linear-gradient(
          to right,
          var(--vscode-editor-background) 4%,
          var(--vscode-editor-inactiveSelectionBackground) 25%,
          var(--vscode-editor-background) 36%
        );
        background-size: 1000px 100%;
      }

      /* Smooth scrolling */
      html {
        scroll-behavior: smooth;
      }

      /* Focus styles for keyboard navigation */
      *:focus-visible {
        outline: 2px solid var(--vscode-focusBorder);
        outline-offset: 2px;
        border-radius: 2px;
      }

      button:focus-visible,
      input:focus-visible {
        outline-offset: -2px;
      }
    </style>
  </head>
  <body>
    <div class="header" role="banner">
      <h1>üìä {{LABEL_OFX_TRANSACTION_VIEWER}}</h1>
      <div class="account-info" role="status" aria-live="polite">{{ACCOUNT_INFO}}</div>
    </div>

    <section class="stats" role="region" aria-label="Financial Summary">
      <div class="stat-card" role="article" aria-label="Total Income">
        <div class="stat-label">{{LABEL_TOTAL_INCOME}}</div>
        <div class="stat-value income" aria-label="Income amount">{{TOTAL_INCOME}}</div>
      </div>
      <div class="stat-card" role="article" aria-label="Total Expenses">
        <div class="stat-label">{{LABEL_TOTAL_EXPENSES}}</div>
        <div class="stat-value expense" aria-label="Expenses amount">{{TOTAL_EXPENSES}}</div>
      </div>
      <div class="stat-card" role="article" aria-label="Net Balance">
        <div class="stat-label">{{LABEL_NET_BALANCE}}</div>
        <div class="stat-value total" aria-label="Balance amount">{{NET_BALANCE}}</div>
      </div>
      <div class="stat-card" role="article" aria-label="Transaction Count">
        <div class="stat-label">{{LABEL_TOTAL_TRANSACTIONS}}</div>
        <div class="stat-value total" aria-label="Number of transactions">
          {{TOTAL_TRANSACTIONS}}
        </div>
      </div>
    </section>

    <section class="chart-container" role="region" aria-label="Income vs Expenses Chart">
      <h2>{{LABEL_INCOME_VS_EXPENSES}}</h2>
      <div class="chart" role="img" aria-label="Bar chart comparing income and expenses">
        <div class="bar-container">
          <div
            class="bar income"
            style="height: 0%"
            data-chart-parcent="{{INCOME_PERCENT}}"
            role="presentation"
          ></div>
          <div class="bar-label">{{LABEL_INCOME}} ({{INCOME_PERCENT}}%)</div>
        </div>
        <div class="bar-container">
          <div
            class="bar expense"
            style="height: 0%"
            data-chart-parcent="{{EXPENSES_PERCENT}}"
            role="presentation"
          ></div>
          <div class="bar-label">{{LABEL_EXPENSES}} ({{EXPENSES_PERCENT}}%)</div>
        </div>
      </div>
    </section>

    <section role="region" aria-label="Transactions">
      <h2>{{LABEL_TRANSACTIONS}}</h2>
      <div class="toolbar">
        <div class="search-container">
          <span class="search-icon" aria-hidden="true">üîç</span>
          <input
            type="text"
            class="search-input"
            placeholder="{{LABEL_SEARCH_PLACEHOLDER}}"
            oninput="searchTransactions(this.value)"
            aria-label="Search transactions"
          />
        </div>
      </div>
      <div class="filters" role="group" aria-label="Transaction type filters">
        {{FILTER_BUTTONS}}
      </div>

      <table role="table" aria-label="Transaction list">
        <thead>
          <tr>
            <th class="sortable" onclick="sortTable('date')" data-column="date" aria-sort="none">
              {{LABEL_DATE}}
            </th>
            <th class="sortable" onclick="sortTable('type')" data-column="type" aria-sort="none">
              {{LABEL_TYPE}}
            </th>
            <th
              class="sortable"
              onclick="sortTable('description')"
              data-column="description"
              aria-sort="none"
            >
              {{LABEL_DESCRIPTION}}
            </th>
            <th
              class="sortable"
              onclick="sortTable('amount')"
              data-column="amount"
              aria-sort="none"
            >
              {{LABEL_AMOUNT}}
            </th>
            <th>{{LABEL_ID}}</th>
          </tr>
        </thead>
        <tbody id="transactions-tbody">
          {{TRANSACTIONS_ROWS}}
        </tbody>
      </table>
    </section>

    <script>
      const vscode = acquireVsCodeApi();
      let currentSort = { column: null, direction: null };
      let allRows = [];

      function filterTransactions(type) {
        vscode.postMessage({
          command: "filter",
          filter: type,
        });
      }

      function animateChartBars() {
        const bars = document.querySelectorAll(".bar");
        bars.forEach((bar) => {
          const percent = bar.getAttribute("data-chart-parcent");
          setTimeout(() => {
            bar.style.height = percent + "%";
          }, 100);
        });
      }

      function searchTransactions(query) {
        const tbody = document.getElementById("transactions-tbody");
        const rows = tbody.getElementsByTagName("tr");
        const searchTerm = query.toLowerCase().trim();

        for (let row of rows) {
          if (row.cells.length === 1) continue; // Skip empty state row

          const date = row.cells[0].textContent.toLowerCase();
          const type = row.cells[1].textContent.toLowerCase();
          const description = row.cells[2].textContent.toLowerCase();
          const amount = row.cells[3].textContent.toLowerCase();
          const id = row.cells[4].textContent.toLowerCase();

          const matches =
            date.includes(searchTerm) ||
            type.includes(searchTerm) ||
            description.includes(searchTerm) ||
            amount.includes(searchTerm) ||
            id.includes(searchTerm);

          row.style.display = matches ? "" : "none";
        }
      }

      function sortTable(column) {
        const tbody = document.getElementById("transactions-tbody");
        const rows = Array.from(tbody.getElementsByTagName("tr"));

        // Remove empty state rows
        const dataRows = rows.filter((row) => row.cells.length > 1);
        if (dataRows.length === 0) return;

        // Determine sort direction
        let direction = "asc";
        if (currentSort.column === column) {
          direction = currentSort.direction === "asc" ? "desc" : "asc";
        }
        currentSort = { column, direction };

        // Update header indicators
        const headers = document.querySelectorAll("th.sortable");
        headers.forEach((header) => {
          header.classList.remove("sorted-asc", "sorted-desc");
          header.setAttribute("aria-sort", "none");
        });
        const currentHeader = document.querySelector(`th[data-column="${column}"]`);
        currentHeader.classList.add(direction === "asc" ? "sorted-asc" : "sorted-desc");
        currentHeader.setAttribute("aria-sort", direction === "asc" ? "ascending" : "descending");

        // Sort rows
        dataRows.sort((a, b) => {
          let aValue, bValue;

          switch (column) {
            case "date":
              aValue = a.cells[0].textContent.trim();
              bValue = b.cells[0].textContent.trim();
              // Convert to comparable date format
              const aDate = new Date(aValue.split("/").reverse().join("-"));
              const bDate = new Date(bValue.split("/").reverse().join("-"));
              return direction === "asc" ? aDate - bDate : bDate - aDate;

            case "type":
              aValue = a.cells[1].textContent.trim().toLowerCase();
              bValue = b.cells[1].textContent.trim().toLowerCase();
              break;

            case "description":
              aValue = a.cells[2].textContent.trim().toLowerCase();
              bValue = b.cells[2].textContent.trim().toLowerCase();
              break;

            case "amount":
              // Extract numeric value from currency string
              aValue = parseFloat(
                a.cells[3].textContent.replace(/[^\d.,-]/g, "").replace(",", ".")
              );
              bValue = parseFloat(
                b.cells[3].textContent.replace(/[^\d.,-]/g, "").replace(",", ".")
              );
              return direction === "asc" ? aValue - bValue : bValue - aValue;

            default:
              aValue = a.cells[0].textContent.trim();
              bValue = b.cells[0].textContent.trim();
          }

          if (aValue < bValue) return direction === "asc" ? -1 : 1;
          if (aValue > bValue) return direction === "asc" ? 1 : -1;
          return 0;
        });

        // Clear and re-append sorted rows
        tbody.innerHTML = "";
        dataRows.forEach((row) => tbody.appendChild(row));
      }

      // Initialize
      animateChartBars();
    </script>
  </body>
</html>
